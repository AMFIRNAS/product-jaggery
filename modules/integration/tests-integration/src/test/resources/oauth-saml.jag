<%

var param = request.getParameter('param');
var oauth = require("oauth");
var wso2is = session.get('cnt');

var samlResp = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNhbWwycDpSZXNwb25zZSBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9sb2NhbGhvc3Q6OTQ0NC9wb3J0YWwvYWNzIiBJRD0iZWVrYmZvbXBtbGpwamxia2JvbWhmbGpqbmhnaG9kY2tobm1ham1oaiIgSW5SZXNwb25zZVRvPSJtZGZhaWtiaGtpb2piZ2JqcGpmY2NsZmVwa2NhcGFwYWRqY29vZWRkIiBJc3N1ZUluc3RhbnQ9IjIwMTUtMTAtMTJUMTE6MTQ6MDkuMzY5WiIgVmVyc2lvbj0iMi4wIiB4bWxuczpzYW1sMnA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCI+PHNhbWwyOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPmxvY2FsaG9zdDwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjZWVrYmZvbXBtbGpwamxia2JvbWhmbGpqbmhnaG9kY2tobm1ham1oaiI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+VjNhUjNzdDVXaExDSmh6Y1ZsSXdIUktsUUxNPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5Qa2o0Qk8vVWpUK0lHaitKOWJCakV5cnZoaHlTc3RNOVVOTXNaTmdIT081WjhsbmxQTWpEUEU2eWI3Ymd5bUxDWklHTXd6bzNFTUx6ci9TT1pSRkh5dktIUGJwdWNjVGwrYVhIK0xFeEdybmN2c2EyQkZmQWtLMkhUZThNcmhVMnFRbi9reUhaWTZ2S0szN0hYdE9NaDIwc2ZMR2hDRE9tQS9tanZnUVl6K1U9PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDTlRDQ0FaNmdBd0lCQWdJRVMzNDNnakFOQmdrcWhraUc5dzBCQVFVRkFEQlZNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhGakFVQmdOVkJBY01EVTF2ZFc1MFlXbHVJRlpwWlhjeERUQUxCZ05WQkFvTUJGZFRUekl4RWpBUUJnTlZCQU1NQ1d4dlkyRnNhRzl6ZERBZUZ3MHhNREF5TVRrd056QXlNalphRncwek5UQXlNVE13TnpBeU1qWmFNRlV4Q3pBSkJnTlZCQVlUQWxWVE1Rc3dDUVlEVlFRSURBSkRRVEVXTUJRR0ExVUVCd3dOVFc5MWJuUmhhVzRnVm1sbGR6RU5NQXNHQTFVRUNnd0VWMU5QTWpFU01CQUdBMVVFQXd3SmJHOWpZV3hvYjNOME1JR2ZNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0R05BRENCaVFLQmdRQ1VwL29WMXZXYzgvVGtRU2lBdlRvdXNNek9NNGFzQjJpbHRyMlFLb3puaTVhVkZ1ODE4TXBPTFpJcjhMTW5UeldsbEp2dmFBNVJBQWRwYkVDYis0OEZqYkJlMGhzZVVkTjVIcHd2bkgvRFc4WmNjR3ZrNTNJNk9ycTdoTEN2MVpIdHVPQ29rZ2h6L0FUcmh5UHErUWt0TWZYblJTNEhyS0dKVHp4YUNjVTdPUUlEQVFBQm94SXdFREFPQmdOVkhROEJBZjhFQkFNQ0JQQXdEUVlKS29aSWh2Y05BUUVGQlFBRGdZRUFXNXdQUjdjcjFMQWRxK0lyUjQ0aVFsUkc1SVRDWlhZOWhJMFB5Z0xQMnJIQU5oK1BZZlRteGJ1T255a05HeWhNNkZqRkxiVzJ1WkhRVFkxak1yUHByak9ybXlLNXNqSlJPNGQxRGVHSFQvWW5JanM5Sm9nUkt2NFhIRUN3THRJVmRBYklkV0hFdFZaSnlNU2t0Y3l5c0ZjdnVoUFFLOFFjL0UvV3E4dUhTQ289PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWwycDpTdGF0dXM+PHNhbWwycDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz48L3NhbWwycDpTdGF0dXM+PHNhbWwyOkFzc2VydGlvbiBJRD0iYmVrZm1icG1wam1naWVmaGVkZWNvYmdtaXBmYmRsbGRwZGRjbGNvaSIgSXNzdWVJbnN0YW50PSIyMDE1LTEwLTEyVDExOjE0OjA5LjM3MloiIFZlcnNpb249IjIuMCIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjxzYW1sMjpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiPmxvY2FsaG9zdDwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjYmVrZm1icG1wam1naWVmaGVkZWNvYmdtaXBmYmRsbGRwZGRjbGNvaSI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+c2xrVEJIaXFRSmlQMFFod2ZWb0ErTXFNQllNPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5UdWRxdk9HWU14bmdSWTFqMHltT25QYkdJa0ZtRlVUZWtpdGJJemxlT1NoeGtCREZSS2c5N1Z4Nnl4ZDROWDZSS1hKMjlvRDhNclVNblV4T1AwRmdwWWt2Sk1oMG04RnhvZmtpNlFIa1l2MGk4dmVYM05Idkx2OTM2UHFmdHE5U2JkbGxlcFdDdjRoaE9aOVZ4ZkdmczdoZE9VYVdVN1pXNDkxT2lFWG95Smc9PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDTlRDQ0FaNmdBd0lCQWdJRVMzNDNnakFOQmdrcWhraUc5dzBCQVFVRkFEQlZNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhGakFVQmdOVkJBY01EVTF2ZFc1MFlXbHVJRlpwWlhjeERUQUxCZ05WQkFvTUJGZFRUekl4RWpBUUJnTlZCQU1NQ1d4dlkyRnNhRzl6ZERBZUZ3MHhNREF5TVRrd056QXlNalphRncwek5UQXlNVE13TnpBeU1qWmFNRlV4Q3pBSkJnTlZCQVlUQWxWVE1Rc3dDUVlEVlFRSURBSkRRVEVXTUJRR0ExVUVCd3dOVFc5MWJuUmhhVzRnVm1sbGR6RU5NQXNHQTFVRUNnd0VWMU5QTWpFU01CQUdBMVVFQXd3SmJHOWpZV3hvYjNOME1JR2ZNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0R05BRENCaVFLQmdRQ1VwL29WMXZXYzgvVGtRU2lBdlRvdXNNek9NNGFzQjJpbHRyMlFLb3puaTVhVkZ1ODE4TXBPTFpJcjhMTW5UeldsbEp2dmFBNVJBQWRwYkVDYis0OEZqYkJlMGhzZVVkTjVIcHd2bkgvRFc4WmNjR3ZrNTNJNk9ycTdoTEN2MVpIdHVPQ29rZ2h6L0FUcmh5UHErUWt0TWZYblJTNEhyS0dKVHp4YUNjVTdPUUlEQVFBQm94SXdFREFPQmdOVkhROEJBZjhFQkFNQ0JQQXdEUVlKS29aSWh2Y05BUUVGQlFBRGdZRUFXNXdQUjdjcjFMQWRxK0lyUjQ0aVFsUkc1SVRDWlhZOWhJMFB5Z0xQMnJIQU5oK1BZZlRteGJ1T255a05HeWhNNkZqRkxiVzJ1WkhRVFkxak1yUHByak9ybXlLNXNqSlJPNGQxRGVHSFQvWW5JanM5Sm9nUkt2NFhIRUN3THRJVmRBYklkV0hFdFZaSnlNU2t0Y3l5c0ZjdnVoUFFLOFFjL0UvV3E4dUhTQ289PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWwyOlN1YmplY3Q+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OmVtYWlsQWRkcmVzcyI+YWRtaW5AY2FyYm9uLnN1cGVyPC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgSW5SZXNwb25zZVRvPSJtZGZhaWtiaGtpb2piZ2JqcGpmY2NsZmVwa2NhcGFwYWRqY29vZWRkIiBOb3RPbk9yQWZ0ZXI9IjIwMTUtMTAtMTJUMTE6MTk6MDkuMzY5WiIgUmVjaXBpZW50PSJodHRwczovL2xvY2FsaG9zdDo5NDQ0L3BvcnRhbC9hY3MiLz48L3NhbWwyOlN1YmplY3RDb25maXJtYXRpb24+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgSW5SZXNwb25zZVRvPSJtZGZhaWtiaGtpb2piZ2JqcGpmY2NsZmVwa2NhcGFwYWRqY29vZWRkIiBOb3RPbk9yQWZ0ZXI9IjIwMTUtMTAtMTJUMTE6MTk6MDkuMzY5WiIgUmVjaXBpZW50PSJodHRwczovL2xvY2FsaG9zdDo5NDQzL29hdXRoMi90b2tlbiIvPjwvc2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbj48L3NhbWwyOlN1YmplY3Q+PHNhbWwyOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDE1LTEwLTEyVDExOjE0OjA5LjM3MloiIE5vdE9uT3JBZnRlcj0iMjAxNS0xMC0xMlQxMToxOTowOS4zNjlaIj48c2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDI6QXVkaWVuY2U+cG9ydGFsPC9zYW1sMjpBdWRpZW5jZT48c2FtbDI6QXVkaWVuY2U+aHR0cHM6Ly9sb2NhbGhvc3Q6OTQ0My9vYXV0aDIvdG9rZW48L3NhbWwyOkF1ZGllbmNlPjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWwyOkNvbmRpdGlvbnM+PHNhbWwyOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxNS0xMC0xMlQxMToxNDowOS4zNzZaIiBTZXNzaW9uSW5kZXg9IjA3YmFhMmQ2LTM3MjMtNDU4Zi04OThkLWIyYTZjN2E5ZmU1NiI+PHNhbWwyOkF1dGhuQ29udGV4dD48c2FtbDI6QXV0aG5Db250ZXh0Q2xhc3NSZWY+dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFjOmNsYXNzZXM6UGFzc3dvcmQ8L3NhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPjwvc2FtbDI6QXV0aG5Db250ZXh0Pjwvc2FtbDI6QXV0aG5TdGF0ZW1lbnQ+PC9zYW1sMjpBc3NlcnRpb24+PC9zYW1sMnA6UmVzcG9uc2U+" // session.get("samlResponse");

var provider = {
    "oauth_version": "2",
    "authorization_url": "https://localhost:9444/oauth2/authorize",
    "access_token_url": "https://localhost:9444/mock-server/", //https://localhost:9443/oauth2/token, https://localhost:9444/mock-server/
    "request_token_url": "https://localhost:9444/oauth2/token",
    "callback_url": "https://localhost:9443/portal",
    "api_key": "JQAGQfMR19ExSdG9TabJxgTzyZMa",
    "api_secret": "khP8q1cb5npLriqGUu4C9kWomfIa"
}

var log = new Log();
if (param == 5) {
    wso2is = null;
    log.info("WSO2 IS Null");
    print("WSO2 IS Null");
} else {
    if (wso2is == null) {
        wso2is = new oauth.OAuthProvider(provider);
        session.put("cnt", wso2is);
    }

    var accessTokenResponse = wso2is.getTokenResponse(samlResp);

    if (param == 1) {
        print(accessTokenResponse.getAccessToken());
    } else if (param == 2) {
        print(accessTokenResponse.getRefreshToken());
    } else if (param == 3) {
        print(accessTokenResponse.getTokenType());
    } else if (param == 4) {
        print(accessTokenResponse.getExpiresIn());
    }

}
%>